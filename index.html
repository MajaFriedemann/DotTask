<!DOCTYPE html>
<html lang="eng-UK">
<head>
    <!--meta data-->
    <meta name="robots" content="noindex">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="favicon.ico?" type="image/x-icon" />
    <title>DOTS TASK</title>
    <meta name="description" content="UIDMUL-IST1">
    <meta name="author" content="Maja Friedemann (GitHub: https://github.com/MajaFriedemann | email: maja.friedemann@gmail.com)">
    <!--link to AWS/Stitch/MongoDB-->
    <script src="https://s3.amazonaws.com/stitch-sdks/js/library/v3/stable/stitch.min.js"></script>
    <!--jQuery and jQuery plugins -->
    <script src="scripts/external/jquery.min.js"></script>
    <script src="scripts/external/jquery-3.3.1.js"></script>
    <script src="scripts/external/jquery-ui.min.js"></script>
    <script src="scripts/external/jquery.mousewheel.min.js"></script>
    <script src="scripts/external/jquery.scrollify.js"></script>
    <!--jsPsych-->
    <script src="scripts/external/jspsych-6.0.2.js"></script>
    <!--staircase-->
    <script src="scripts/external/Staircase.js"></script>
    <!--Intro.js library-->
    <script src="scripts/external/intro-custom.js"></script>
    <link href="styles/external/introjs.min.css" rel="stylesheet" type="text/css">
    <!--math & stats functions-->
    <script src="scripts/external/seedrandom.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/p5"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/6.2.2/math.js"></script>
    <!--Modernizr-->
    <script src="scripts/external/modernizr-UIDMUL-IST-180521.js"></script>
    <!--custom CSS-->
    <link href="https://use.typekit.net/ivu3ect.css" rel="stylesheet">
    <link href="styles/style.css" rel="stylesheet" type="text/css">
    <!--custom JS: helper functions-->
    <script src="scripts/helper.js"></script>
    <script src="scripts/gameboard.js"></script>
    <script src="scripts/gameboard_forced.js"></script>
    <script src="scripts/dots.js"></script>
    <!--custom JS: trials-->
    <script src="scripts/jspsych-consent.js"></script>
    <script src="scripts/jspsych-debriefing.js"></script>
    <script src="scripts/jspsych-demographics.js"></script>
    <script src="scripts/jspsych-dots.js"></script>
    <script src="scripts/jspsych-feedback-form.js"></script>
    <script src="scripts/jspsych-IST.js"></script>
    <script src="scripts/jspsych-IST-forced.js"></script>
    <script src="scripts/jspsych-IST-tutorial.js"></script>
    <script src="scripts/jspsych-IUS12.js"></script>
    <script src="scripts/jspsych-IUS27.js"></script>
    <script src="scripts/jspsych-loading.js"></script>
    <script src="scripts/jspsych-message-splash.js"></script>
    <script src="scripts/jspsych-notice.js"></script>
    <script src="scripts/jspsych-PIS.js"></script>
    <script src="scripts/jspsych-PHQ9.js"></script>
    <script src="scripts/jspsych-score-reveal.js"></script>
    <script src="scripts/jspsych-SSMS.js"></script>
    <script src="scripts/jspsych-STAI-Y2.js"></script>
</head>

<body></body>
<script>
    /* The following are global variables (available across plugins).
    (note: these must be declared directly in <script> and not within $(document).ready)
    */

    /* PROLIFIC PARAMETERS */

    var ProlificID = getUrlVars()['PROLIFIC_PID'];
    console.log(ProlificID);
    var completionCode = "VCYWS1GQ";
    var completionURL = "https://app.prolific.ac/submissions/complete?cc=" + completionCode;
    var PHQexclusionURL = "https://app.prolific.ac/submissions/complete?cc=EXCLU001";

    /* EXPERIMENT INFORMATION */

    var subjectID;
    var exp_release = '4.0.0 public release';
    var release_date = '2020/01/10';
    var testing_timeline = false;
    var trialTypeOrder = 'tiles only';
    var scoreRuleOrder;
    var cohort = 'PR';
    var cohort_explain = '';
    var CUREC_studyName = 'Understanding Individual Differences in Mechanisms of Uncertainty and Learning';
    var CUREC_ID = 'R56625/RE003';
    var CUREC_version = '2.4';
    var CUREC_date = '2018/08/09';
    var consent_version = '2.4';
    var consent_date = '2018/08/09';
    var PIS_version = '2.4';
    var PIS_date = '2018/08/09'
    var startExperiment = Date.now();
    var currentAttempt = 1;


    /* SEEDED RANDOMISATION
    Get the random subject identifier from cookies, or if there isn't one, set one and make a cookie with the random subject identifier to expire within the year */

    if (getCookie('UIDMUL-IST-subjectID')) {
        subjectID = getCookie('UIDMUL-IST-subjectID');
        //update the number of attempts
        existingAttempts = Number(getCookie('UIDMUL-IST-attempts'));
        currentAttempt = 1 + existingAttempts;
        setCookie('UIDMUL-IST-attempts', currentAttempt, 365);
    } else {
        subjectID = genRandIdentifier(9);
        setCookie('UIDMUL-IST-subjectID', subjectID, 365);
        setCookie('UIDMUL-IST-attempts', currentAttempt, 365);
    }

    // seed the randomisations
    Math.seedrandom(subjectID);

    // set up counterbalancing
    var counterBalance_seed1 = Math.random();
    var counterBalance_seed2 = Math.random();

    if (!testing_timeline) {

        if (trialTypeOrder == false) {
            // set trial type order
            if (counterBalance_seed1 < 0.5) {
                trialTypeOrder = 'dots-tiles';
            } else {
                trialTypeOrder = 'tiles-dots';
            }
        }

        // set score rule order
        if (counterBalance_seed2 > 0.5) {
            scoreRuleOrder = 'FW-DW';
        } else {
            scoreRuleOrder = 'DW-FW';
        }

    } else {
        trialTypeOrder = 'testing';
        scoreRuleOrder = 'testing';
    }


    /* IMAGES TO PRELOAD */

    var images = [
        'assets/oxford-logo.jpg',
        'assets/gameboard.gif',
        'assets/gameboard_2.4.0.gif',
        'assets/gameboard-ISTc-forced.gif',
        'assets/dotTask_2.5.0 practice.gif',
        'assets/dotTask_2.5.0 seeAgain.gif',
        'assets/checkmark-white.svg',
        'assets/down-arrow-2.svg',
        'assets/up-arrow.svg'
    ];

    var dotsStaircase = new Staircase({
        logSpace: {
            firstVal: 100,
            down: 2,
            up: 1,
            wait: true,
            operation: 'logspace',
            breaks: [0, 5, 10],
            stepSizeDown: [0.4, 0.2, 0.1],
            stepSizeUp: [0.4, 0.2, 0.1],
            direction: -1,
            limits: [1, 100],
            verbosity: 1
        }
    });

    dotsStaircase.init();

    /* DATA VARIABLES */
    var IST_totalTrials = 0;
    var IST_cumulativeScore = 0;
    var IST_cumulativeCorrect = 0;

    var dots_totalTrials = 0;
    var dots_totalCorrect = 0;
    var dots_blockCount = 0;
    var dotsBlockCounter = 0;
    var staircaseSteps = 0;
    var dots_cumulativeScore = 0;
    var dots_overallAccuracy = 0;

    var bonusPayment = 0;

    var dataObject = {
        subjectID: subjectID,
        prolificID: ProlificID,
        experiment_version: exp_release,
        experiment_version_date: release_date,
        experiment_condition: cohort_explain,
        trialType_order: trialTypeOrder,
        scoreRule_order: scoreRuleOrder,
        attempts: currentAttempt,

        CUREC_ID: CUREC_ID,
        CUREC_version: CUREC_version,
        CUREC_date: CUREC_date,
        PIS_version: PIS_version,
        PIS_date: PIS_date,
        PIS_acknowledged: undefined,
        consent_version: consent_version,
        consent_date: consent_date,
        consented: undefined,

        age: undefined,
        gender: undefined,
        handedness: undefined,
        demographicsRTs: [],
        demographics_duration: 0,

        PHQ_score: 0,
        PHQ_scorelist: [],
        PHQ_QA: {},
        PHQ_RTs: [],
        PHQ_duration: 0,

        STAI_score: 0,
        STAI_scorelist: [],
        STAI_QA: {},
        STAI_RTs: [],
        STAI_duration: 0,

        IUS_score: 0,
        IUS_scorelist: [],
        IUS_QA: {},
        IUS_RTs: [],
        IUS_duration: 0,

        SSMS_score: 0,
        SSMS_RTs: [],
        SSMS_duration: 0,

        SSMS_UE_score: 0,
        SSMS_UE_scorelist: [],
        SSMS_UE_QA: {},
        SSMS_CD_score: 0,
        SSMS_CD_scorelist: [],
        SSMS_CD_QA: {},
        SSMS_IA_score: 0,
        SSMS_IA_scorelist: [],
        SSMS_IA_QA: {},
        SSMS_IN_score: 0,
        SSMS_IN_scorelist: [],
        SSMS_IN_QA: {},

        IST_trialType: [],
        IST_scoreRule: [],
        IST_isTutorialMode: [],
        IST_isForcedChoice: [],
        IST_leftRight_randoms: [],
        IST_scores: [],
        IST_buttonChoice: [],
        IST_isCorrect: [],
        IST_FW_pCorrect: [],
        IST_DW_pCorrect: [],
        IST_difficulty: [],
        IST_repetition: [],
        IST_majoritySide: [],
        IST_majorityColour: [],
        IST_minorityColour: [],
        IST_majorityTiles: [],
        IST_minorityTiles: [],
        IST_totalSeen: [],
        IST_DW_totalSeen: [],
        IST_FW_totalSeen: [],
        IST_tileSequence: [],
        IST_majoritySequence: [],
        IST_minoritySequence: [],
        IST_majoritySeen: [],
        IST_minoritySeen: [],
        IST_confidence_preset: [],
        IST_confidence_actual: [],
        IST_confidence_ratings: [],
        IST_trialRT: [],
        IST_choiceRT: [],
        IST_tileRTs: [],
        IST_confidenceRTs: [],

        dots_accuracy: [],
        dots_isTutorialMode: [],
        dots_staircase: [],
        dots_pairs: [],
        dots_majoritySide: [],
        dots_confidences: [],
        dots_defaultOption: [],
        dots_moreAsked: [],
        dots_isCorrect: [],
        dots_RTs: [],
        dots_waitTimes: [],

        technical_issues: undefined,
        feedback_strategy: undefined,
        feedback_technical: undefined,
        feedback_comments: undefined,
        debriefing: undefined,
        feedback_ratings: {}
    };


    /* EXPERIMENTAL PAGES */

    // ethics
    var PIS = {
        type: 'jspsych-PIS',
        studyName: CUREC_studyName,
        CUREC_ID: CUREC_ID,
        version: PIS_version,
        date: PIS_date
    };

    var consent = {
        type: 'jspsych-consent',
        studyName: CUREC_studyName,
        CUREC_ID: CUREC_ID,
        version: consent_version,
        date: consent_date
    };

    var debriefing = {
        type: 'jspsych-debriefing',
        studyName: CUREC_studyName,
        CUREC_ID: CUREC_ID,
        version: CUREC_version,
        date: CUREC_date
    };

    // questionnaires
    var PHQ9 = {
        type: 'jspsych-PHQ9',
        subtitle: '(2 sections, estimated length: 2 minutes)',
        activeBracketing: true,
        redirectLink: PHQexclusionURL
    };

    var STAI_Y2 = {
        type: 'jspsych-STAI-Y2',
        subtitle: '(2 sections, estimated length: 5 minutes)'
    };

    var SSMS = {
        type: 'jspsych-SSMS',
        subtitle: '(4 sections, estimated length: 10 minutes)'
    };

    var IUS12 = {
        type: 'jspsych-IUS12',
        subtitle: '(2 sections, estimated length: 3 minutes)'
    };

    var IUS27 = {
        type: 'jspsych-IUS27',
        subtitle: '(5 sections, estimated length: 5 minutes)'
    };

    var demographics = {
        type: 'jspsych-demographics'
    };

    // IST/ISTc tutorials

    var DW_tutorial1 = {
        type: 'jspsych-IST-tutorial',
        trial_type: 'IST',
        score_rule: 'DW',
        showRule: true,
        confidenceFrequency: 'none',
        isFirstTime: true
    };

    var DW_tutorial2 = {
        type: 'jspsych-IST-tutorial',
        trial_type: 'IST',
        score_rule: 'DW',
        showRule: true,
        confidenceFrequency: 'none',
        isFirstTime: false
    };

    var FW_tutorial1 = {
        type: 'jspsych-IST-tutorial',
        trial_type: 'IST',
        score_rule: 'FW',
        showRule: true,
        confidenceFrequency: 'none',
        isFirstTime: true
    };

    var FW_tutorial2 = {
        type: 'jspsych-IST-tutorial',
        trial_type: 'IST',
        score_rule: 'FW',
        showRule: true,
        confidenceFrequency: 'none',
        isFirstTime: false
    };

    var DWc_tutorial1 = {
        type: 'jspsych-IST-tutorial',
        trial_type: 'ISTc',
        score_rule: 'DW',
        showRule: true,
        confidenceFrequency: 'randomInt',
        isFirstTime: true
    };

    var DWc_tutorial2 = {
        type: 'jspsych-IST-tutorial',
        trial_type: 'ISTc',
        score_rule: 'DW',
        showRule: true,
        confidenceFrequency: 'randomInt',
        isFirstTime: false
    };

    var FWc_tutorial1 = {
        type: 'jspsych-IST-tutorial',
        trial_type: 'ISTc',
        score_rule: 'FW',
        showRule: true,
        confidenceFrequency: 'randomInt',
        isFirstTime: true
    };

    var FWc_tutorial2 = {
        type: 'jspsych-IST-tutorial',
        trial_type: 'ISTc',
        score_rule: 'FW',
        showRule: true,
        confidenceFrequency: 'randomInt',
        isFirstTime: false
    };

    var FWc_forced_tutorial = {
        type: 'jspsych-IST-tutorial',
        trial_type: 'forced',
        score_rule: 'FW',
        showRule: true,
        confidenceFrequency: 'randomInt',
        isFirstTime: false
    };

    var DWc_forced_tutorial = {
        type: 'jspsych-IST-tutorial',
        trial_type: 'forced',
        score_rule: 'DW',
        showRule: true,
        confidenceFrequency: 'randomInt',
        isFirstTime: false
    }

    // IST/ISTc experimental blocks

    var DW_block = {
        type: 'jspsych-IST',
        trial_type: 'IST',
        confidenceFrequency: 'none',
        score_rule: 'DW',
        showRule: true,
        showScore: false,
        showCumulative: false,
        trial_count: 10
    };

    var FW_block = {
        type: 'jspsych-IST',
        trial_type: 'IST',
        confidenceFrequency: 'none',
        score_rule: 'FW',
        showRule: true,
        trial_count: 10
    };

    var DWc_block = {
        type: 'jspsych-IST',
        trial_type: 'ISTc',
        confidenceFrequency: 'randomInt',
        score_rule: 'DW',
        showRule: true,
        trial_count: 10
    };

    var FWc_block = {
        type: 'jspsych-IST',
        trial_type: 'ISTc',
        confidenceFrequency: 'randomInt',
        score_rule: 'FW',
        showRule: true,
        trial_count: 10
    };

    var FWc_forced_block = {
        type: 'jspsych-IST-forced',
        trial_type: 'ISTc',
        confidenceFrequency: 'randomInt',
        score_rule: 'FW',
        pCorrect: 'FW',
        showRule: true,
        trial_count: 10
        // pCorrect: [0.4, 1, 0.7, 0.5, 0.65, 0.75, 0.8, 1, 0.7, 0.6]
    };

    var DWc_forced_block = {
        type: 'jspsych-IST-forced',
        trial_type: 'ISTc',
        confidenceFrequency: 'randomInt',
        score_rule: 'DW',
        pCorrect: 'DW',
        showRule: true,
        trial_count: 10
        // pCorrect: [0.5, 1, 0.7, 0.5, 0.65, 0.75, 0.8, 1, 0.7, 0.6]
    };

    // IST score change / forced choice notification pages
    var FW_prelude = {
        type: 'jspsych-message-splash',
        name: 'FW_prelude',
        message: 'The game mode has now been set to "Fixed".',
        submessage: '<h2>You will be playing the same game as before, but in "Fixed" mode, if you correctly choose the majority colour, you will <highlight style="color: rgb(13,255,146)">win 100 points, regardless of the number of tiles you choose</highlight>. However, you will still lose 100 points if you choose the majority colour incorrectly.</h2> <br><br> <h1>Press the OK button below to continue to the next 10 rounds.</h1>',
        backgroundColor: 'rgb(0,0,0)',
        subjectID: subjectID,
        buttonEnabled: true,
        buttonText: 'OK'
    };

    var DW_prelude = {
        type: 'jspsych-message-splash',
        name: 'DW_prelude',
        message: 'The game mode has now been set to "Decreasing".',
        submessage: '<h2>You will be playing the same game as before, but in "Decreasing" mode, the number of points you earn for a correct answer will vary: if you correctly choose the majority colour, you will <highlight style="color: rgb(13,255,146)">win 10 points for every black tile remaining on the board</highlight>. However, you will still lose 100 points if you choose the majority colour incorrectly.</h2> <br><br> <h1>Press the OK button below to continue to the next 10 rounds.</h1>',
        backgroundColor: 'rgb(0,0,0)',
        subjectID: subjectID,
        buttonEnabled: true,
        buttonText: 'OK'
    };

    var forced_prelude = {
        type: 'jspsych-message-splash',
        name: 'forced_prelude',
        message: 'The computer will now tell you when to guess.',
        submessage: '<h2>As before, you can turn over any of the tiles. The response buttons at the bottom will be grey at the start. <highlight style="color: rgb(13,255,146)">When they change colour, please make your best guess as to the majority colour.</highlight> You will win 100 points if you correctly choose the majority colour, and lose 100 points if you choose incorrectly.</h2> <br><br> <h1>Press the OK button below to continue to the next 20 rounds.</h1>',
        backgroundColor: 'rgb(0,0,0)',
        subjectID: subjectID,
        buttonEnabled: true,
        buttonText: 'OK'
    };

    // dot task
    var dotTaskPractice1 = {
        type: 'jspsych-dots',
        dot_minimum: 200,
        canvasWidth: 445,
        canvasHeight: 180,
        leftColor: 'rgb(255,255,255)',
        rightColor: 'rgb(255,255,255)',
        waitTimeLimit: 2000,
        isTutorialMode: true,
        trial_count: 25,
        yellowButtonEnabled: false,
        greenButtonName: 'CONTINUE',
        seeAgain: 'easier'
    };

    var dotTaskPractice2 = {
        type: 'jspsych-dots',
        dot_minimum: 200,
        canvasWidth: 445,
        canvasHeight: 180,
        leftColor: 'rgb(255,255,255)',
        rightColor: 'rgb(255,255,255)',
        waitTimeLimit: 2000,
        isTutorialMode: true,
        trial_count: 25,
        seeAgain: 'easier'
    };

    var dotTask1 = {
        type: 'jspsych-dots',
        dot_minimum: 200,
        canvasWidth: 445,
        canvasHeight: 180,
        leftColor: 'rgb(255,255,255)',
        rightColor: 'rgb(255,255,255)',
        waitTimeLimit: 2000,
        isTutorialMode: false,
        trial_count: 25,
        blockCounterEnabled: true,
        seeAgain: 'easier'
    };

    var dotTask2 = {
        type: 'jspsych-dots',
        dot_minimum: 200,
        canvasWidth: 445,
        canvasHeight: 180,
        leftColor: 'rgb(255,255,255)',
        rightColor: 'rgb(255,255,255)',
        waitTimeLimit: 2000,
        isTutorialMode: false,
        trial_count: 25,
        blockCounterEnabled: true,
        seeAgain: 'easier'
    };

    var dotTask3 = {
        type: 'jspsych-dots',
        dot_minimum: 200,
        canvasWidth: 445,
        canvasHeight: 180,
        leftColor: 'rgb(255,255,255)',
        rightColor: 'rgb(255,255,255)',
        waitTimeLimit: 2000,
        isTutorialMode: false,
        trial_count: 25,
        blockCounterEnabled: true,
        seeAgain: 'easier'
    };

    var dotTask4 = {
        type: 'jspsych-dots',
        dot_minimum: 200,
        canvasWidth: 445,
        canvasHeight: 180,
        leftColor: 'rgb(255,255,255)',
        rightColor: 'rgb(255,255,255)',
        waitTimeLimit: 2000,
        isTutorialMode: false,
        trial_count: 25,
        blockCounterEnabled: true,
        seeAgain: 'easier'
    };

    var dotTaskInstructions1 = {
        type: 'jspsych-notice',
        section1_text: 'In the next part of the experiment, you will be playing a game with dots.',
        section2_text: 'During this game, you will see two boxes containing dots on either side of the centre of the screen (marked with a "+" sign). Your task is to decide whether the left or right box contains more dots. You will give your answer on a sliding scale to indicate which box you think contained more dots, and also how confident you are in that decision. Hover over the slider bar to change the slider position - towards the middle if you aren\'t sure of your answer, and towards one side if you\'re confident - then click on the slider bar to register your answer. After you respond, you will get feedback about whether the side you picked was <highlight style="color: rgb(13,255,146)">CORRECT</highlight> or <highlight style="color: rgb(255,0,51)">INCORRECT</highlight>. <br><br> The task will start off quite easy <u>but will become harder</u> as you progress. <br><br> Press the "Continue" button to continue to some practice trials.',
        img_id: 'dotTask-gif1'
    };

    var dotTaskInstructions2 = {
        type: 'jspsych-notice',
        section1_text: 'From now on, you have the option to see the stimulus again before submitting a final response.',
        section2_text: 'After clicking on the slider to register your initial answer, you will now see two buttons instead of one: "Final Answer" (to move on to the next trial if you are satisfied with your current answer) and "See Again" (to see <u>an easier version</u> of the dot grids again). <br><br> Press the "Continue" button to continue to a few more practice trials featuring the new "See Again" option.',
        img_id: 'dotTask-gif2'
    };


    // linking pages

    // flat bonus wording: <highlight style="color: rgb(13,255,146)">A cash bonus will be awarded if you are more than 55% accurate over all trials in the next 4 blocks, based on your "Final Answer".</highlight>

    // Brier score wording: <highlight style="color: rgb(13,255,146)">You will earn points depending on whether your "Final Answer" is correct and how accurate your confidence judgment was.</highlight> For instance, you would earn 1 point if you answer "Certainly Left" and are correct, but 0 points if you answer "Certainly Left" and are incorrect. Your points will be converted to a cash bonus at the end of the experiment, so <u>you will earn more with more accurate confidence judgments</u>.

    var dotTaskStart = {
        type: 'jspsych-message-splash',
        name: 'dotStart',
        subjectID: subjectID,
        message: 'You have now completed the practice trials for the dot task.',
        submessage: 'For the rest of the experiment, you\'ll be doing the task you just practiced. There will be <u>four blocks of 25 trials</u>, which should take approximately 10 minutes to complete altogether. You will be able to take a short break in between the blocks. <br><br> You will no longer be given feedback after each trial about whether your answer was correct or incorrect. Instead, you will be shown your accuracy after each block. <br><br> <highlight style="color: rgb(13,255,146)">A cash bonus will be awarded if you are more than 60% accurate over all trials in the next 4 blocks, based on your "Final Answer".</highlight> <br><br> Press "CONTINUE" to continue to the first block of 25 trials.',
        backgroundColor: 'rgb(0,0,0)',
        buttonEnabled: true,
        buttonText: 'CONTINUE',
        lineSpacing: '130%',
        submessageSize: '2.8vmin'
    };

    var dotTaskRest = {
        type: 'jspsych-message-splash',
        name: 'dotTaskRest',
        subjectID: subjectID,
        message: '',
        variableMessage: 'dotRest flat',
        submessage: 'You may take a break now if you wish. Please press "CONTINUE" when you are ready to start the next block.',
        backgroundColor: 'rgb(0,0,0)',
        buttonEnabled: true,
        buttonText: 'CONTINUE',
        lineSpacing: '130%',
        submessageSize: '2.8vmin'
    };

    var ISTScoreReveal = {
        type: 'jspsych-score-reveal',
        performanceType: 'score',
        conversionFactor: 0.0003
    };

    var dotsScoreReveal = {
        type: 'jspsych-score-reveal',
        performanceType: 'accuracy',
        bonusThreshold: 60,
        flatBonusAmount: 0.5
    };

    var thankYou = {
        type: 'jspsych-message-splash',
        name: 'thankYou',
        message: 'Thank you for completing the study! <br> <h4>You will now be returned to Prolific for your participant payment. If you are not automatically redirected in 2 seconds, please click <a href="' + completionURL + '">here</a>.</h4>',
        endPage: true,
        subjectID: subjectID
    };

    var loading = {
        type: 'jspsych-loading',
        subjectID: subjectID
    };

    var questionnaireSplash = {
        type: 'jspsych-message-splash',
        name: 'questionnaireIntro',
        message: 'The experiment starts with a few questions for you.',
        subjectID: subjectID,
        buttonEnabled: true
    };

    var feedbackPoll = {
        type: 'jspsych-feedback-form',
        askStrategy: true
    };


    /* TIMELINES FOR RELEASE & TESTING */
    switch(trialTypeOrder) {

        case 'tiles only':
            if (scoreRuleOrder == 'FW-DW') {
                var timeline = [
                    loading,
                    PIS,
                    consent,
                    demographics,
                    FWc_tutorial1,
                    FWc_block,
                    DW_prelude,
                    DWc_block,
                    FWc_forced_tutorial,
                    FWc_forced_block,
                    DW_prelude,
                    DWc_forced_block,
                    ISTScoreReveal,
                    feedbackPoll,
                    debriefing,
                    thankYou
                ];
            } else {
                var timeline = [
                    loading,
                    PIS,
                    consent,
                    demographics,
                    DWc_tutorial1,
                    DWc_block,
                    FW_prelude,
                    FWc_block,
                    DWc_forced_tutorial,
                    DWc_forced_block,
                    FW_prelude,
                    FWc_forced_block,
                    ISTScoreReveal,
                    feedbackPoll,
                    debriefing,
                    thankYou
                ];
            }
            break;

        case 'dots-tiles':
            if (scoreRuleOrder == 'FW-DW') {
                var timeline = [
                    loading,
                    PIS,
                    consent,
                    demographics,
                    PHQ9,
                    STAI_Y2,
                    SSMS,
                    IUS27,
                    dotTaskInstructions1,
                    dotTaskPractice1,
                    dotTaskInstructions2,
                    dotTaskPractice2,
                    dotTaskStart,
                    dotTask1,
                    dotTaskRest,
                    dotTask2,
                    dotTaskRest,
                    dotTask3,
                    dotTaskRest,
                    dotTask4,
                    dotsScoreReveal,
                    FWc_tutorial1,
                    FWc_block,
                    DW_prelude,
                    DWc_block,
                    ISTScoreReveal,
                    feedbackPoll,
                    debriefing,
                    thankYou
                ];
            } else {
                var timeline = [
                    loading,
                    PIS,
                    consent,
                    demographics,
                    PHQ9,
                    STAI_Y2,
                    SSMS,
                    IUS27,
                    dotTaskInstructions1,
                    dotTaskPractice1,
                    dotTaskInstructions2,
                    dotTaskPractice2,
                    dotTaskStart,
                    dotTask1,
                    dotTaskRest,
                    dotTask2,
                    dotTaskRest,
                    dotTask3,
                    dotTaskRest,
                    dotTask4,
                    dotsScoreReveal,
                    DWc_tutorial1,
                    DWc_block,
                    FW_prelude,
                    FWc_block,
                    ISTScoreReveal,
                    feedbackPoll,
                    debriefing,
                    thankYou
                ];
            }
            break;

        case 'tiles-dots':
            if (scoreRuleOrder == 'FW-DW') {
                var timeline = [
                    loading,
                    PIS,
                    consent,
                    demographics,
                    PHQ9,
                    STAI_Y2,
                    SSMS,
                    IUS27,
                    FWc_tutorial1,
                    FWc_block,
                    DW_prelude,
                    DWc_block,
                    ISTScoreReveal,
                    dotTaskInstructions1,
                    dotTaskPractice1,
                    dotTaskInstructions2,
                    dotTaskPractice2,
                    dotTaskStart,
                    dotTask1,
                    dotTaskRest,
                    dotTask2,
                    dotTaskRest,
                    dotTask3,
                    dotTaskRest,
                    dotTask4,
                    dotsScoreReveal,
                    feedbackPoll,
                    debriefing,
                    thankYou
                ];
            } else {
                var timeline = [
                    loading,
                    PIS,
                    consent,
                    demographics,
                    PHQ9,
                    STAI_Y2,
                    SSMS,
                    IUS27,
                    DWc_tutorial1,
                    DWc_block,
                    FW_prelude,
                    FWc_block,
                    ISTScoreReveal,
                    dotTaskInstructions1,
                    dotTaskPractice1,
                    dotTaskInstructions2,
                    dotTaskPractice2,
                    dotTaskStart,
                    dotTask1,
                    dotTaskRest,
                    dotTask2,
                    dotTaskRest,
                    dotTask3,
                    dotTaskRest,
                    dotTask4,
                    dotsScoreReveal,
                    feedbackPoll,
                    debriefing,
                    thankYou
                ];
            }
            break;

        case 'testing':
            var timeline = [
                FWc_forced_tutorial,
                FWc_forced_block,
                DW_prelude,
                DWc_forced_block,
                ISTScoreReveal,
                feedbackPoll,
                debriefing,
                thankYou
            ];
            break;

        default:
            var timeline = [loading];
    }

    /* JSPSYCH & MONGODB */

    jsPsych.init({
        timeline: timeline,
        preload_images: images,
        show_preload_progress_bar: false, // hide preload progress bar
        on_finish: function() {
            var endExperiment = Date.now();
            var testTime = msToMinSec(endExperiment - startExperiment);
            // link up to Stitch with a promise
            var clientPromise = stitch.StitchClientFactory.create('uidmul-ist-sbgze');
            // add all experimental details to dataObject
            dataObject["dots_staircase"] = dotsStaircase.get('logSpace');
            dataObject["IST_cumulativeScore"] = IST_cumulativeScore;
            dataObject["dots_overallAccuracy"] = dots_overallAccuracy;
            dataObject["bonus_earned"] = bonusPayment;
            dataObject["date_completed"] = longformDate();
            dataObject["duration"] = testTime;

            // link up to Stitch
            clientPromise.then(client => {
                const db = client.service('mongodb', 'mongodb-atlas').db('IST');
                client.login().then(() => {
                    db.collection('IST1').insertOne(dataObject)
                }).then(() => {
                    console.log('[MongoDB Stitch] Connected to Stitch with insertOne');
                }).catch(err => {
                    console.error(err);
                });
            });
        }
    });
</script>
</html>